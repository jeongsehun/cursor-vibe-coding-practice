name: PR ìë™ í• ë‹¹

on:
  pull_request:
    types: [opened, ready_for_review]

jobs:
  auto-assign:
    runs-on: ubuntu-latest
    steps:
    - name: PR ì‘ì„±ì í• ë‹¹
      uses: actions/github-script@v7
      with:
        script: |
          const { owner, repo, number } = context.issue;
          const pr = context.payload.pull_request;
          
          // PR ì‘ì„±ìë¥¼ assigneeë¡œ í• ë‹¹
          await github.rest.issues.addAssignees({
            owner,
            repo,
            issue_number: number,
            assignees: [pr.user.login]
          });
          
          console.log(`PR ì‘ì„±ì ${pr.user.login}ì´ í• ë‹¹ë˜ì—ˆìŠµë‹ˆë‹¤.`);

    - name: ì½”ë“œ ì†Œìœ ì ê¸°ë°˜ ë¦¬ë·°ì–´ í• ë‹¹
      uses: actions/github-script@v7
      with:
        script: |
          const { owner, repo, number } = context.issue;
          const pr = context.payload.pull_request;
          
          // íŒŒì¼ ë³€ê²½ì‚¬í•­ì„ ê°€ì ¸ì™€ì„œ ë¦¬ë·°ì–´ ê²°ì •
          const files = await github.rest.pulls.listFiles({
            owner,
            repo,
            pull_number: number
          });
          
          const reviewers = new Set();
          const teamReviewers = new Set();
          
          for (const file of files.data) {
            const filename = file.filename;
            
            // íŒŒì¼ ê²½ë¡œì— ë”°ë¥¸ ë¦¬ë·°ì–´ í• ë‹¹ ë¡œì§
            if (filename.includes('streamlit') || filename.includes('frontend') || filename.endsWith('.py') && filename.includes('ui')) {
              // Frontend ë³€ê²½ì‚¬í•­
              console.log(`Frontend ë³€ê²½ ê°ì§€: ${filename}`);
            } else if (filename.includes('fastapi') || filename.includes('api') || filename.includes('backend')) {
              // Backend ë³€ê²½ì‚¬í•­
              console.log(`Backend ë³€ê²½ ê°ì§€: ${filename}`);
            } else if (filename.includes('agent') || filename.includes('langgraph') || filename.includes('llm')) {
              // Agent ë³€ê²½ì‚¬í•­
              console.log(`Agent ë³€ê²½ ê°ì§€: ${filename}`);
            } else if (filename.includes('test') || filename.includes('spec')) {
              // í…ŒìŠ¤íŠ¸ ë³€ê²½ì‚¬í•­
              console.log(`í…ŒìŠ¤íŠ¸ ë³€ê²½ ê°ì§€: ${filename}`);
            } else if (filename.includes('.github') || filename.includes('ci') || filename.includes('cd')) {
              // CI/CD ë³€ê²½ì‚¬í•­
              console.log(`CI/CD ë³€ê²½ ê°ì§€: ${filename}`);
            }
          }
          
          // ê¸°ë³¸ ë¦¬ë·°ì–´ (í”„ë¡œì íŠ¸ ê´€ë¦¬ìë‚˜ ì‹œë‹ˆì–´ ê°œë°œì)
          // ì‹¤ì œ ì‚¬ìš©ì‹œì—ëŠ” ì‹¤ì œ GitHub ì‚¬ìš©ìëª…ìœ¼ë¡œ ë³€ê²½ í•„ìš”
          const defaultReviewers = []; // ì˜ˆ: ['project-manager', 'senior-dev']
          
          if (defaultReviewers.length > 0) {
            try {
              await github.rest.pulls.requestReviewers({
                owner,
                repo,
                pull_number: number,
                reviewers: defaultReviewers
              });
              console.log(`ê¸°ë³¸ ë¦¬ë·°ì–´ í• ë‹¹: ${defaultReviewers.join(', ')}`);
            } catch (error) {
              console.log('ë¦¬ë·°ì–´ í• ë‹¹ ì‹¤íŒ¨ (ì‚¬ìš©ìê°€ ì¡´ì¬í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ):', error.message);
            }
          }

    - name: PR í¬ê¸°ì— ë”°ë¥¸ ì¶”ê°€ ë¦¬ë·°ì–´ í• ë‹¹
      uses: actions/github-script@v7
      with:
        script: |
          const { owner, repo, number } = context.issue;
          const pr = context.payload.pull_request;
          
          // í° PRì˜ ê²½ìš° ì¶”ê°€ ë¦¬ë·°ì–´ í• ë‹¹
          if (pr.changed_files > 10 || (pr.additions + pr.deletions) > 300) {
            console.log('í° PR ê°ì§€ - ì¶”ê°€ ë¦¬ë·°ì–´ í• ë‹¹ì„ ê³ ë ¤í•´ì£¼ì„¸ìš”');
            
            const comment = `
            ğŸ“¢ **í° PR ê°ì§€ - ì¶”ê°€ ë¦¬ë·° ìš”ì²­**
            
            ì´ PRì€ ë§ì€ ë³€ê²½ì‚¬í•­ì„ í¬í•¨í•˜ê³  ìˆì–´ ì¶”ê°€ ë¦¬ë·°ì–´ì˜ ê²€í† ê°€ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            
            **ë³€ê²½ì‚¬í•­**:
            - íŒŒì¼: ${pr.changed_files}ê°œ
            - ë¼ì¸: +${pr.additions}/-${pr.deletions}
            
            í”„ë¡œì íŠ¸ ê´€ë¦¬ìëŠ” ì ì ˆí•œ ì¶”ê°€ ë¦¬ë·°ì–´ë¥¼ í• ë‹¹í•´ì£¼ì„¸ìš”.
            `;
            
            await github.rest.issues.createComment({
              owner,
              repo,
              issue_number: number,
              body: comment
            });
          } 