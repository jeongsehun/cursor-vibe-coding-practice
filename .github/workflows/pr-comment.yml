name: PR ìë™ ëŒ“ê¸€

on:
  pull_request:
    types: [opened, synchronize]

jobs:
  comment:
    runs-on: ubuntu-latest
    steps:
    - name: PR í™˜ì˜ ëŒ“ê¸€
      if: github.event.action == 'opened'
      uses: actions/github-script@v7
      with:
        script: |
          const { owner, repo, number } = context.issue;
          const welcomeComment = `
          ğŸ‰ **ìƒˆë¡œìš´ Pull Requestì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!**
          
          ì´ PRì„ ê²€í† í•˜ê¸° ì „ì— ë‹¤ìŒ ì‚¬í•­ë“¤ì„ í™•ì¸í•´ì£¼ì„¸ìš”:
          
          ## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸
          - [ ] ì½”ë“œ ë³€ê²½ì‚¬í•­ì´ ìš”êµ¬ì‚¬í•­ì„ ì¶©ì¡±í•˜ë‚˜ìš”?
          - [ ] ìƒˆë¡œìš´ í…ŒìŠ¤íŠ¸ê°€ ì¶”ê°€ë˜ì—ˆë‚˜ìš”? (í•´ë‹¹í•˜ëŠ” ê²½ìš°)
          - [ ] ê¸°ì¡´ í…ŒìŠ¤íŠ¸ê°€ ëª¨ë‘ í†µê³¼í•˜ë‚˜ìš”?
          - [ ] ë¬¸ì„œê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆë‚˜ìš”? (í•´ë‹¹í•˜ëŠ” ê²½ìš°)
          - [ ] ì½”ë“œ ìŠ¤íƒ€ì¼ ê°€ì´ë“œë¥¼ ë”°ë¥´ë‚˜ìš”?
          
          ## ğŸ“‹ êµ¬ì„± ìš”ì†Œë³„ ì²´í¬
          ${context.payload.pull_request.changed_files > 0 ? '- [ ] Frontend (Streamlit) ë³€ê²½ì‚¬í•­ í™•ì¸' : ''}
          ${context.payload.pull_request.title.toLowerCase().includes('api') || context.payload.pull_request.title.toLowerCase().includes('fastapi') ? '- [ ] Backend (FastAPI) ë³€ê²½ì‚¬í•­ í™•ì¸' : ''}
          ${context.payload.pull_request.title.toLowerCase().includes('agent') || context.payload.pull_request.title.toLowerCase().includes('langgraph') ? '- [ ] Agent (LangGraph) ë³€ê²½ì‚¬í•­ í™•ì¸' : ''}
          
          ## ğŸ” ë¦¬ë·° í¬ì¸íŠ¸
          - ì½”ë“œ í’ˆì§ˆ ë° ê°€ë…ì„±
          - ë³´ì•ˆ ì·¨ì•½ì  ê²€í† 
          - ì„±ëŠ¥ ì˜í–¥ ë¶„ì„
          - ì—ëŸ¬ ì²˜ë¦¬ ì ì ˆì„±
          
          ê°ì‚¬í•©ë‹ˆë‹¤! ğŸš€
          `;
          
          await github.rest.issues.createComment({
            owner,
            repo,
            issue_number: number,
            body: welcomeComment
          });

    - name: PR ì—…ë°ì´íŠ¸ ëŒ“ê¸€
      if: github.event.action == 'synchronize'
      uses: actions/github-script@v7
      with:
        script: |
          const { owner, repo, number } = context.issue;
          const updateComment = `
          ğŸ”„ **PRì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤!**
          
          ìƒˆë¡œìš´ ì»¤ë°‹ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤. ë¦¬ë·°ì–´ë“¤ì€ ë³€ê²½ì‚¬í•­ì„ ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.
          
          **ìµœê·¼ ì»¤ë°‹**: ${context.payload.after.substring(0, 7)}
          **ë³€ê²½ëœ íŒŒì¼ ìˆ˜**: ${context.payload.pull_request.changed_files}ê°œ
          **ì¶”ê°€ëœ ë¼ì¸**: +${context.payload.pull_request.additions}
          **ì‚­ì œëœ ë¼ì¸**: -${context.payload.pull_request.deletions}
          
          ìë™ í…ŒìŠ¤íŠ¸ê°€ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤... âš¡
          `;
          
          await github.rest.issues.createComment({
            owner,
            repo,
            issue_number: number,
            body: updateComment
          });

    - name: í° PR ê²½ê³  ëŒ“ê¸€
      uses: actions/github-script@v7
      with:
        script: |
          const { owner, repo, number } = context.issue;
          const pr = context.payload.pull_request;
          
          // í° PR ê¸°ì¤€: ë³€ê²½ëœ íŒŒì¼ 20ê°œ ì´ìƒ ë˜ëŠ” 500ë¼ì¸ ì´ìƒ ë³€ê²½
          if (pr.changed_files > 20 || (pr.additions + pr.deletions) > 500) {
            const warningComment = `
            âš ï¸ **í° PR ê°ì§€**
            
            ì´ PRì€ ìƒë‹¹í•œ ì–‘ì˜ ë³€ê²½ì‚¬í•­ì„ í¬í•¨í•˜ê³  ìˆìŠµë‹ˆë‹¤:
            - ë³€ê²½ëœ íŒŒì¼: ${pr.changed_files}ê°œ
            - ë³€ê²½ëœ ë¼ì¸: ${pr.additions + pr.deletions}ë¼ì¸
            
            ë” ë‚˜ì€ ë¦¬ë·°ë¥¼ ìœ„í•´ ë‹¤ìŒì„ ê³ ë ¤í•´ë³´ì„¸ìš”:
            1. PRì„ ë” ì‘ì€ ë‹¨ìœ„ë¡œ ë¶„í• 
            2. ìƒì„¸í•œ ì„¤ëª…ê³¼ í…ŒìŠ¤íŠ¸ ê³„íš ì œê³µ
            3. í•µì‹¬ ë³€ê²½ì‚¬í•­ í•˜ì´ë¼ì´íŠ¸
            
            ë¦¬ë·°ì–´ëŠ” íŠ¹ë³„íˆ ì£¼ì˜ ê¹Šê²Œ ê²€í† í•´ì£¼ì„¸ìš”! ğŸ”
            `;
            
            await github.rest.issues.createComment({
              owner,
              repo,
              issue_number: number,
              body: warningComment
            });
          } 