name: ì´ìŠˆ ìë™ í• ë‹¹

on:
  issues:
    types: [opened, labeled]

jobs:
  auto-assign:
    runs-on: ubuntu-latest
    steps:
    - name: ì»´í¬ë„ŒíŠ¸ ê¸°ë°˜ ìë™ í• ë‹¹
      uses: actions/github-script@v7
      with:
        script: |
          const { owner, repo, number } = context.issue;
          const issue = context.payload.issue;
          const title = issue.title.toLowerCase();
          const body = (issue.body || '').toLowerCase();
          
          let assignees = [];
          
          // ì»´í¬ë„ŒíŠ¸ë³„ ë‹´ë‹¹ì ë§¤í•‘ (ì‹¤ì œ ì‚¬ìš©ì‹œ ì‹¤ì œ GitHub ì‚¬ìš©ìëª…ìœ¼ë¡œ ë³€ê²½)
          const componentAssignees = {
            // 'streamlit': ['frontend-dev'],
            // 'fastapi': ['backend-dev'],
            // 'agent': ['ai-dev'],
            // 'infrastructure': ['devops-dev'],
            // 'documentation': ['tech-writer']
          };
          
          // ì œëª©ê³¼ ë³¸ë¬¸ì—ì„œ ì»´í¬ë„ŒíŠ¸ í‚¤ì›Œë“œ ê²€ìƒ‰
          for (const [component, devs] of Object.entries(componentAssignees)) {
            if (title.includes(component) || body.includes(component)) {
              assignees.push(...devs);
            }
          }
          
          // Streamlit ê´€ë ¨ í‚¤ì›Œë“œ
          if (title.includes('streamlit') || body.includes('streamlit') || 
              title.includes('frontend') || body.includes('ui') || body.includes('interface')) {
            console.log('Streamlit/Frontend ê´€ë ¨ ì´ìŠˆ ê°ì§€');
            // assignees.push('frontend-dev');
          }
          
          // FastAPI ê´€ë ¨ í‚¤ì›Œë“œ
          if (title.includes('fastapi') || body.includes('fastapi') || 
              title.includes('api') || title.includes('backend') || title.includes('server')) {
            console.log('FastAPI/Backend ê´€ë ¨ ì´ìŠˆ ê°ì§€');
            // assignees.push('backend-dev');
          }
          
          // Agent ê´€ë ¨ í‚¤ì›Œë“œ
          if (title.includes('agent') || body.includes('langgraph') || 
              title.includes('llm') || title.includes('langchain') || title.includes('ai')) {
            console.log('Agent/AI ê´€ë ¨ ì´ìŠˆ ê°ì§€');
            // assignees.push('ai-dev');
          }
          
          // ê¸°ë³¸ ë‹´ë‹¹ì (í”„ë¡œì íŠ¸ ê´€ë¦¬ì)
          if (assignees.length === 0) {
            // assignees.push('project-manager');
            console.log('ê¸°ë³¸ ë‹´ë‹¹ìì—ê²Œ í• ë‹¹');
          }
          
          // ì¤‘ë³µ ì œê±°
          assignees = [...new Set(assignees)];
          
          // ì‹¤ì œ í• ë‹¹ (ì‚¬ìš©ìê°€ ì¡´ì¬í•˜ëŠ” ê²½ìš°ë§Œ)
          if (assignees.length > 0) {
            try {
              await github.rest.issues.addAssignees({
                owner,
                repo,
                issue_number: number,
                assignees: assignees
              });
              console.log(`í• ë‹¹ëœ ë‹´ë‹¹ì: ${assignees.join(', ')}`);
            } catch (error) {
              console.log('ë‹´ë‹¹ì í• ë‹¹ ì‹¤íŒ¨ (ì‚¬ìš©ìê°€ ì¡´ì¬í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ):', error.message);
            }
          }

    - name: ìš°ì„ ìˆœìœ„ ê¸°ë°˜ ì¶”ê°€ í• ë‹¹
      uses: actions/github-script@v7
      with:
        script: |
          const { owner, repo, number } = context.issue;
          const issue = context.payload.issue;
          
          // í˜„ì¬ ì´ìŠˆì˜ ë¼ë²¨ í™•ì¸
          const labels = issue.labels.map(label => label.name);
          
          // Critical ë˜ëŠ” High priority ì´ìŠˆì˜ ê²½ìš° ì¶”ê°€ ë‹´ë‹¹ì í• ë‹¹
          if (labels.includes('priority:critical') || labels.includes('priority:high')) {
            console.log('ë†’ì€ ìš°ì„ ìˆœìœ„ ì´ìŠˆ ê°ì§€');
            
            // ì¶”ê°€ ì•Œë¦¼ ëŒ“ê¸€
            const urgentComment = `
          ğŸš¨ **ë†’ì€ ìš°ì„ ìˆœìœ„ ì´ìŠˆ ê°ì§€**
          
          ì´ ì´ìŠˆëŠ” ë†’ì€ ìš°ì„ ìˆœìœ„ë¡œ ë¶„ë¥˜ë˜ì–´ ì¶”ê°€ ê´€ë¦¬ìì—ê²Œë„ ì•Œë¦¼ì´ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.
          
          **ì²˜ë¦¬ ì¼ì •**:
          - Critical: 24ì‹œê°„ ì´ë‚´ ì´ˆê¸° ì‘ë‹µ
          - High: 48ì‹œê°„ ì´ë‚´ ì´ˆê¸° ì‘ë‹µ
          
          ì‹ ì†í•œ ì²˜ë¦¬ë¥¼ ìœ„í•´ ìµœëŒ€í•œ ë¹ ë¥´ê²Œ ê²€í† í•˜ê² ìŠµë‹ˆë‹¤! âš¡
            `;
            
            await github.rest.issues.createComment({
              owner,
              repo,
              issue_number: number,
              body: urgentComment
            });
            
            // ì‹œë‹ˆì–´ ê°œë°œìë‚˜ íŒ€ ë¦¬ë“œì—ê²Œ ì¶”ê°€ í• ë‹¹
            // const seniorDevs = ['senior-dev', 'team-lead'];
            // try {
            //   await github.rest.issues.addAssignees({
            //     owner,
            //     repo,
            //     issue_number: number,
            //     assignees: seniorDevs
            //   });
            // } catch (error) {
            //   console.log('ì‹œë‹ˆì–´ ê°œë°œì í• ë‹¹ ì‹¤íŒ¨:', error.message);
            // }
          }

    - name: ì´ìŠˆ íƒ€ì…ë³„ í…œí”Œë¦¿ í™•ì¸
      uses: actions/github-script@v7
      with:
        script: |
          const { owner, repo, number } = context.issue;
          const issue = context.payload.issue;
          const body = issue.body || '';
          
          // ë²„ê·¸ ë¦¬í¬íŠ¸ í…œí”Œë¦¿ í™•ì¸
          if (issue.title.toLowerCase().includes('bug') || body.toLowerCase().includes('bug')) {
            const requiredSections = [
              'í˜„ì¬ ë™ì‘',
              'ì˜ˆìƒ ë™ì‘', 
              'ì¬í˜„ ë‹¨ê³„',
              'í™˜ê²½ ì •ë³´'
            ];
            
            const missingSections = requiredSections.filter(section => 
              !body.toLowerCase().includes(section.toLowerCase())
            );
            
            if (missingSections.length > 0) {
              const templateComment = `
          ğŸ“‹ **ë²„ê·¸ ë¦¬í¬íŠ¸ í…œí”Œë¦¿ í™•ì¸**
          
          ë” ë¹ ë¥¸ ë²„ê·¸ í•´ê²°ì„ ìœ„í•´ ë‹¤ìŒ ì •ë³´ê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤:
          
          ${missingSections.map(section => `- ${section}`).join('\n')}
          
          ê°€ëŠ¥í•˜ì‹œë©´ ì´ìŠˆ ì„¤ëª…ì„ í¸ì§‘í•˜ì—¬ ì¶”ê°€ ì •ë³´ë¥¼ ì œê³µí•´ì£¼ì„¸ìš”:
          
          **í˜„ì¬ ë™ì‘**: ì‹¤ì œë¡œ ì–´ë–¤ ì¼ì´ ë°œìƒí•˜ëŠ”ì§€
          **ì˜ˆìƒ ë™ì‘**: ì–´ë–¤ ì¼ì´ ë°œìƒí•´ì•¼ í•˜ëŠ”ì§€  
          **ì¬í˜„ ë‹¨ê³„**: 1. 2. 3. ë‹¨ê³„ë³„ ì„¤ëª…
          **í™˜ê²½ ì •ë³´**: Python ë²„ì „, OS, ë¸Œë¼ìš°ì € ë“±
          
          ê°ì‚¬í•©ë‹ˆë‹¤! ğŸ›
              `;
              
              await github.rest.issues.createComment({
                owner,
                repo,
                issue_number: number,
                body: templateComment
              });
            }
          }
          
          // ê¸°ëŠ¥ ìš”ì²­ í…œí”Œë¦¿ í™•ì¸
          if (issue.title.toLowerCase().includes('feature') || 
              issue.title.toLowerCase().includes('enhancement') ||
              body.toLowerCase().includes('feature request')) {
            
            const requiredSections = [
              'ê¸°ëŠ¥ ì„¤ëª…',
              'ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤',
              'ìˆ˜ìš© ê¸°ì¤€'
            ];
            
            const missingSections = requiredSections.filter(section => 
              !body.toLowerCase().includes(section.toLowerCase())
            );
            
            if (missingSections.length > 0) {
              const featureTemplateComment = `
          âœ¨ **ê¸°ëŠ¥ ìš”ì²­ í…œí”Œë¦¿ í™•ì¸**
          
          ê¸°ëŠ¥ ê°œë°œì„ ìœ„í•´ ë‹¤ìŒ ì •ë³´ê°€ ë” í•„ìš”í•©ë‹ˆë‹¤:
          
          ${missingSections.map(section => `- ${section}`).join('\n')}
          
          ì´ìŠˆ ì„¤ëª…ì— ë‹¤ìŒ ë‚´ìš©ì„ ì¶”ê°€í•´ì£¼ì‹œë©´ ë„ì›€ì´ ë©ë‹ˆë‹¤:
          
          **ê¸°ëŠ¥ ì„¤ëª…**: ì–´ë–¤ ê¸°ëŠ¥ì„ ì›í•˜ì‹œë‚˜ìš”?
          **ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤**: ì–¸ì œ, ì–´ë–»ê²Œ ì‚¬ìš©ë ê¹Œìš”?
          **ìˆ˜ìš© ê¸°ì¤€**: ì–´ë–»ê²Œ ë˜ë©´ ì™„ì„±ëœ ê²ƒì¸ê°€ìš”?
          
          ìì„¸í•œ ì •ë³´ë¥¼ ì œê³µí•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤! ğŸš€
              `;
              
              await github.rest.issues.createComment({
                owner,
                repo,
                issue_number: number,
                body: featureTemplateComment
              });
            }
          } 